{"version":3,"sources":["../../../src/lib/db.ts"],"sourcesContent":["import fs from 'fs';\r\nimport path from 'path';\r\n\r\nimport { Product, User } from './types';\r\n\r\nconst dataDir = path.join(process.cwd(), 'data');\r\nexport const productsFile = path.join(dataDir, 'products.json');\r\nexport const usersFile = path.join(dataDir, 'users.json');\r\n\r\n// Ensure data directory exists (lazy check, though write_to_file handles creation, runtime needs it too)\r\nif (!fs.existsSync(dataDir)) {\r\n    fs.mkdirSync(dataDir, { recursive: true });\r\n}\r\n\r\nfunction readJSON(file: string) {\r\n    if (!fs.existsSync(file)) {\r\n        // Initialize with empty array if missing\r\n        writeJSON(file, []);\r\n        return [];\r\n    }\r\n    try {\r\n        const data = fs.readFileSync(file, 'utf-8');\r\n        return JSON.parse(data);\r\n    } catch (error) {\r\n        console.error(`Error reading ${file}:`, error);\r\n        return [];\r\n    }\r\n}\r\n\r\nfunction writeJSON(file: string, data: any) {\r\n    fs.writeFileSync(file, JSON.stringify(data, null, 2));\r\n}\r\n\r\nexport const db = {\r\n    products: {\r\n        getAll: () => readJSON(productsFile) as Product[],\r\n        getById: (id: string) => (readJSON(productsFile) as Product[]).find(p => p.id === id),\r\n    },\r\n    users: {\r\n        findByEmail: (email: string) => (readJSON(usersFile) as User[]).find(u => u.email === email),\r\n        create: (user: User) => {\r\n            const users = readJSON(usersFile) as User[];\r\n            users.push(user);\r\n            writeJSON(usersFile, users);\r\n            return user;\r\n        }\r\n    }\r\n};\r\n"],"names":[],"mappings":"gqCAAA,IAAA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OAIA,IAAM,EAAU,EAAA,OAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,GAAI,QAC5B,EAAe,EAAA,OAAI,CAAC,IAAI,CAAC,EAAS,iBAClC,EAAY,EAAA,OAAI,CAAC,IAAI,CAAC,EAAS,cAO5C,SAAS,EAAS,CAAY,EAC1B,GAAI,CAAC,EAAA,OAAE,CAAC,UAAU,CAAC,GAGf,IAHsB,GAEtB,EAAU,EAAM,EAAE,EACX,EAAE,CAEb,GAAI,CACA,IAAM,EAAO,EAAA,OAAE,CAAC,YAAY,CAAC,EAAM,SACnC,OAAO,KAAK,KAAK,CAAC,EACtB,CAAE,MAAO,EAAO,CAEZ,OADA,QAAQ,KAAK,CAAC,CAAC,cAAc,EAAE,EAAK,CAAC,CAAC,CAAE,GACjC,EAAE,AACb,CACJ,CAEA,SAAS,EAAU,CAAY,CAAE,CAAS,EACtC,EAAA,OAAE,CAAC,aAAa,CAAC,EAAM,KAAK,SAAS,CAAC,EAAM,KAAM,GACtD,CArBI,AAAC,EAAA,OAAE,CAAC,UAAU,CAAC,IACf,EAAA,IADyB,GACvB,CAAC,SAAS,CAAC,EAAS,CAAE,WAAW,CAAK,eAsB1B,CACd,SAAU,CACN,OAAQ,IAAM,EAAS,GACvB,QAAS,AAAC,GAAgB,EAAS,GAA4B,IAAI,CAAC,GAAK,EAAE,EAAE,GAAK,EACtF,EACA,MAAO,CACH,YAAa,AAAC,GAAmB,EAAS,GAAsB,IAAI,CAAC,GAAK,EAAE,KAAK,GAAK,GACtF,OAAQ,AAAC,IACL,IAAM,EAAQ,EAAS,GAGvB,OAFA,EAAM,IAAI,CAAC,GACX,EAAU,EAAW,GACd,CACX,CACJ,CACJ"}